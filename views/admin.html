{% extends "layout.html" %}

{% block title %}TA Evaluations Admin Panel{% endblock %}

{% block content %}

<div id="email"><p>{{ admin.email }}</p></div>
<div id="email"><p>Eval Duration: {{ eval_time }} hours</p></div>

{% for error in errors %}
  <div class="error">Error: {{ error }}</div>
{% endfor %}

{% for warning in warnings %}
  <div class="warning">Warning: {{ warning }}</div>
{% endfor %}

{% for success in successes %}
  <div class="success">{{ success }}</div>
{% endfor %}

{% if not courses %}
  <h2>Upload CSV File</h2>
  <form action="/admin" method="post" enctype="multipart/form-data">
    <div>TAs CSV File: <input type="file" name="tas" /></div>
    <div>Students CSV File: <input type="file" name="students" /></div>
    <div>
      <input type="hidden" name="action" value="upload" />
      <input type="hidden" name="token" value="{{ form_token }}" />
      <input type="submit" value="Upload" />
    </div>
  </form>
{% else %}
  <h1>Statistics</h1>
  <div><a href="/admin/all">All</a></div>
  <ol>
  {% for course in courses %}
    <li><a href="/admin/s/{{ course.0 }}">{{ course.0 }}</a>
      <ol>
	{% for ta in course.1 %}
	  <li><a href="/admin/s/{{ course.0 }}/{{ ta.0 }}">{{ ta.0 }}</a>:
	    {{ ta.1.completed }} completed, {{ ta.1.remaining }} remaining
	    {% if not ta.1.ta_email %}
	    <span class="tiny error"> (no TA email)</span>
	    {% endif %}
	    {% if not ta.1.prof_email %}
	    <span class="tiny error"> (no prof email)</span>
	    {% endif %}
	    {% if not ta.1.sent_results %}
	    <span class="tiny error"> (results not sent)</span>
	    {% endif %}
	  </li>
	{% endfor %}
      </ol>
    </li>
  {% endfor %}
  </ol>
  <hr/>
  <form action="/admin" method="post">
    <input type="hidden" name="action" value="email" />
    <input type="hidden" name="token" value="{{ form_token }}" />
    <div>
      From Name: <input type="text" name="name" />
      <input type="submit" value="Email Invites" />
      (Emails are sent from your email address)
    </div>
  </form>
  <form action="/admin" method="post">
    <div>
      Type 0xDEADBEEF to confirm: <input type="text" name="confirm" />
      <input type="hidden" name="action" value="reset" />
      <input type="hidden" name="token" value="{{ form_token }}" />
      <input type="submit" value="Reset Database" />
    </div>
  </form>
  <form action="/admin" method="post" enctype="multipart/form-data">
    <div>
      <input type="hidden" name="action" value="tamapping" />
      <input type="hidden" name="token" value="{{ form_token }}" />
      TA Mapping File: <input type="file" name="tas" />
      <input type="submit" value="Upload TA Mapping" />
    </div>
  </form>
  <form action="/admin" method="post" enctype="multipart/form-data">
    <div>
      <input type="hidden" name="action" value="professor" />
      <input type="hidden" name="token" value="{{ form_token }}" />
      Professor File: <input type="file" name="professor" />
      <input type="submit" value="Upload Professor" />
    </div>
  </form>
  <p><a href="/admin/dl">Download all results</a></p>
{% endif %}
{% endblock %}
